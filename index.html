<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ABCD Method: Stem ‚Äî Batterista Online</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0b0d0e;
  --bg2:#111416;
  --surface:rgba(255,255,255,0.05);
  --border:rgba(255,255,255,0.1);
  --border2:rgba(255,255,255,0.15);
  --accent:#5dda9d;
  --accent2:#3a9d7a;
  --accent3:#2a7c5f;
  --text:#e8e8e8;
  --text2:#a0a0a0;
  --text3:#6b6b6b;
  --neutral-400:#a3a3a3;
  --neutral-500:#737373;
  --neutral-600:#525252;
  /* ABCD phase colors */
  --phase-a:#5f8dff;
  --phase-a-text:#98b5f5;
  --phase-b:#f1b54f;
  --phase-b-text:#f4d48a;
  --phase-c:#ff865c;
  --phase-c-text:#ffb08a;
  --phase-d:#5dda9d;
  --phase-d-text:#9de7c6;
}
body{background:var(--bg);color:var(--text);font-family:'DM Sans','Helvetica Neue',sans-serif;min-height:100vh;padding:36px 22px 80px;font-size:16px}
.app{max-width:1040px;margin:0 auto;display:flex;flex-direction:column;gap:18px}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;padding-bottom:18px;border-bottom:1px solid var(--border)}
.logo h1{font-size:2.2rem;font-weight:300;letter-spacing:-.01em;color:#d4d4d8;line-height:1}
.logo h1 .la{font-weight:600;color:#88a7d0}
.logo h1 .lb{font-weight:600;color:#c2b68a}
.logo h1 .lc{font-weight:600;color:#d9a88a}
.logo h1 .ld{font-weight:600;color:#8ab7aa}
.logo h1 .method{padding-left:8px;font-weight:300;color:#a3a3a3}
.logo h1 .stem{color:#8ab7aa;font-weight:600}
.logo-sub{font-size:10px;color:var(--neutral-500);margin-top:6px}
.header-right a{color:var(--neutral-500);text-decoration:none;font-size:11px;transition:color .2s}
.header-right a:hover{color:var(--accent)}

/* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:22px}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.card-label{font-size:9px;text-transform:uppercase;letter-spacing:.4em;color:var(--neutral-500);font-weight:600}

/* ‚îÄ‚îÄ Setup ‚îÄ‚îÄ */
.setup-card{background:rgba(93,218,157,0.03);border:1px solid rgba(93,218,157,0.15);border-radius:20px;padding:24px}
.setup-title{font-size:.95rem;font-weight:600;color:var(--text);margin-bottom:8px}
.setup-desc{font-size:13px;color:var(--neutral-400);line-height:1.75;margin-bottom:18px}
.setup-desc code{background:rgba(255,255,255,0.06);padding:2px 7px;border-radius:4px;font-family:'DM Mono',monospace;font-size:11px;color:var(--text)}
.input-row{display:flex;gap:10px;flex-wrap:wrap}
.space-input{flex:1;min-width:200px;background:rgba(0,0,0,0.4);border:1px solid var(--border);border-radius:12px;padding:11px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:13px;outline:none;transition:border-color .2s}
.space-input:focus{border-color:var(--accent)}
.space-input::placeholder{color:var(--neutral-600)}
.btn-primary{background:linear-gradient(135deg,#3e5c55,#2e4741);border:none;border-radius:12px;padding:11px 20px;color:#fff;font-weight:600;font-size:13px;cursor:pointer;white-space:nowrap;font-family:'DM Sans',sans-serif;box-shadow:0 0 14px rgba(93,218,157,0.15);transition:all .2s}
.btn-primary:hover{box-shadow:0 0 22px rgba(93,218,157,0.3);transform:translateY(-1px)}

/* ‚îÄ‚îÄ Upload ‚îÄ‚îÄ */
.upload-zone{border:2px dashed rgba(93,218,157,0.2);border-radius:16px;padding:48px 24px;text-align:center;cursor:pointer;transition:all .25s;position:relative;overflow:hidden;background:rgba(93,218,157,0.02)}
.upload-zone:hover,.upload-zone.over{border-color:rgba(93,218,157,0.45);background:rgba(93,218,157,0.05)}
.upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upload-icon{font-size:2.2rem;margin-bottom:12px}
.upload-title{font-size:1rem;font-weight:600;color:var(--text);margin-bottom:6px}
.upload-sub{font-size:12px;color:var(--neutral-400)}
.upload-fmt{font-size:11px;color:var(--neutral-600);margin-top:6px}
.upload-warn{margin-top:14px;background:rgba(241,181,79,0.06);border:1px solid rgba(241,181,79,0.18);border-radius:12px;padding:12px 16px;font-size:11px;color:#c49a35;line-height:1.7}
.upload-warn b{color:var(--phase-b)}

/* ‚îÄ‚îÄ Status ‚îÄ‚îÄ */
.status-inner{display:flex;flex-direction:column;gap:14px}
.status-top{display:flex;align-items:center;gap:14px}
.spinner{width:32px;height:32px;border-radius:50%;border:3px solid rgba(93,218,157,0.1);border-top-color:var(--accent);animation:spin .8s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}
.s-title{font-size:.95rem;font-weight:600;color:var(--text)}
.s-sub{font-size:11px;color:var(--neutral-400);margin-top:3px}
.prog-track{height:3px;background:rgba(255,255,255,0.05);border-radius:99px;overflow:hidden}
.prog-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--accent3),var(--accent));width:0%;transition:width .6s ease;box-shadow:0 0 6px rgba(93,218,157,0.35)}
.prog-fill.slide{width:25%;animation:slide 1.2s ease-in-out infinite}
@keyframes slide{0%{transform:translateX(-350%)}100%{transform:translateX(550%)}}
.steps{display:flex;gap:6px;flex-wrap:wrap}
.pill{font-size:9px;padding:3px 9px;border-radius:99px;border:1px solid rgba(255,255,255,0.08);color:var(--neutral-600);background:rgba(255,255,255,0.02);transition:all .3s;font-weight:500}
.pill.on{border-color:rgba(93,218,157,0.35);color:var(--accent);background:rgba(93,218,157,0.07)}
.pill.done{border-color:rgba(93,218,157,0.15);color:var(--accent2)}
.pill.done::before{content:"‚úì "}

/* ‚îÄ‚îÄ Error ‚îÄ‚îÄ */
.err-card{background:rgba(239,68,68,0.04);border:1px solid rgba(239,68,68,0.18);border-radius:20px;padding:22px;display:none}
.err-title{font-weight:600;color:#f87171;margin-bottom:6px}
.err-msg{font-size:12px;color:var(--neutral-400);line-height:1.65;white-space:pre-wrap}
.btn-retry{margin-top:12px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);color:#f87171;border-radius:10px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s}
.btn-retry:hover{background:rgba(239,68,68,0.2)}

/* ‚îÄ‚îÄ Waveform ‚îÄ‚îÄ */
#waveform-canvas{cursor:pointer}


/* ‚îÄ‚îÄ Transport ‚îÄ‚îÄ */
.transport-controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:14px}
#transport-bar{padding:14px 4px 2px;display:flex;flex-direction:column;gap:12px}
#transport-top{display:flex;align-items:baseline;gap:10px}
#transport-top .time-display{font-size:1.8rem}
#track-name{font-size:11px;color:var(--neutral-500);margin-left:6px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}
#transport-btns{display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}
.tbn-ic{width:42px;height:42px;border-radius:12px;border:1px solid var(--border);background:var(--surface);color:var(--neutral-400);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s}
.tbn-ic:hover{background:rgba(255,255,255,0.1);color:var(--text)}
.tbn-sep{width:1px;height:28px;background:var(--border);margin:0 2px}
.tbn-txt{height:42px;border-radius:12px;border:1px solid var(--border);background:var(--surface);color:var(--neutral-400);cursor:pointer;padding:0 18px;font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px;transition:all .2s;font-family:'DM Sans',sans-serif}
.tbn-txt:hover{background:rgba(255,255,255,0.1);color:var(--text)}
.tbn-grn{height:42px;border-radius:12px;border:1px solid rgba(93,218,157,0.22);background:rgba(93,218,157,0.07);color:var(--accent);cursor:pointer;padding:0 18px;font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px;transition:all .2s;font-family:'DM Sans',sans-serif}
.tbn-grn:hover{background:rgba(93,218,157,0.13)}
.time-display{font-family:'DM Mono',monospace;font-size:1.4rem;font-weight:500;color:var(--accent);min-width:90px}
.time-dur{font-family:'DM Mono',monospace;font-size:11px;color:var(--neutral-600)}
.tbns{margin-left:auto;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.btn-play-main{width:52px;height:52px;border-radius:14px;border:none;background:linear-gradient(135deg,#3e5c55,#2e4741);color:#fff;font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 0 16px rgba(93,218,157,0.18);transition:all .2s}
.btn-play-main:hover{transform:scale(1.06);box-shadow:0 0 24px rgba(93,218,157,0.32)}
.btn-ic{width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--neutral-400);cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;transition:all .2s}
.btn-ic:hover{background:rgba(255,255,255,0.1);color:var(--text)}
.btn-txt{height:36px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--neutral-400);cursor:pointer;padding:0 12px;font-size:11px;font-weight:600;display:flex;align-items:center;gap:5px;transition:all .2s;font-family:'DM Sans',sans-serif;white-space:nowrap}
.btn-txt:hover{background:rgba(255,255,255,0.1);color:var(--text)}
.btn-grn{height:36px;border-radius:10px;border:1px solid rgba(93,218,157,0.2);background:rgba(93,218,157,0.07);color:var(--accent);cursor:pointer;padding:0 12px;font-size:11px;font-weight:600;display:flex;align-items:center;gap:5px;transition:all .2s;font-family:'DM Sans',sans-serif;white-space:nowrap}
.btn-grn:hover{background:rgba(93,218,157,0.13)}
.btn-dl{height:36px;border-radius:10px;border:1px solid rgba(93,218,157,0.3);background:rgba(93,218,157,0.08);color:var(--accent);cursor:pointer;padding:0 14px;font-size:11px;font-weight:700;display:flex;align-items:center;gap:6px;transition:all .2s;font-family:'DM Sans',sans-serif;white-space:nowrap}
.btn-dl:hover{background:rgba(93,218,157,0.15);box-shadow:0 0 12px rgba(93,218,157,0.18)}

/* ‚îÄ‚îÄ Collapse ‚îÄ‚îÄ */
.collapse-btn{width:24px;height:24px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--neutral-400);cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;transition:background .2s}
.collapse-btn:hover{background:rgba(255,255,255,0.1)}
.collapsible{overflow:hidden;transition:max-height .35s ease,opacity .3s ease}
.collapsible.collapsed{max-height:0!important;opacity:0;pointer-events:none}

/* ‚îÄ‚îÄ Solo banner ‚îÄ‚îÄ */
.solo-ban{display:none;align-items:center;gap:7px;font-size:9px;color:#fbbf24;font-weight:700;background:rgba(251,191,36,0.07);border:1px solid rgba(251,191,36,0.2);border-radius:8px;padding:4px 10px;letter-spacing:.05em}
.solo-ban button{background:none;border:none;color:#fbbf24;cursor:pointer;opacity:.6;font-size:13px;line-height:1;padding:0}
.solo-ban button:hover{opacity:1}

/* ‚îÄ‚îÄ Channel strip ‚îÄ‚îÄ */
.ch-scroll-outer{overflow-x:auto;margin:-12px;padding:12px;}
.ch-scroll-outer::-webkit-scrollbar{height:2px}
.ch-scroll-outer::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:2px}
#scroll-hint{text-align:center;font-size:10px;color:var(--neutral-600);letter-spacing:.15em;margin-top:10px;user-select:none;transition:opacity .4s}
#scroll-hint.hidden{opacity:0}
.ch-scroll{display:flex;gap:12px;align-items:stretch;padding-bottom:4px;}


.ch{flex-shrink:0;width:120px;border-radius:16px;border:1px solid var(--border);background:rgba(255,255,255,0.03);padding:10px 7px 12px;display:flex;flex-direction:column;align-items:center;gap:7px;position:relative;transition:box-shadow .3s,border-color .3s}

/* LED Display */
.ch-display{width:100%;background:#060809;border:1px solid rgba(255,255,255,0.07);border-radius:8px;padding:6px 4px 5px;display:flex;flex-direction:column;align-items:center;gap:3px}
.ch-label-led{font-size:8px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;font-family:'DM Mono',monospace;line-height:1}
.led-meters{display:flex;gap:3px;align-items:flex-end;height:50px;margin-top:2px}
.led-col{display:flex;flex-direction:column;gap:1.5px}
.led-seg{width:9px;height:4.5px;border-radius:1.5px}
.ch-db-led{font-family:'DM Mono',monospace;font-size:7px;color:#2a3035;margin-top:2px;letter-spacing:.05em}

/* Fader */
.fader-track{width:8px;height:175px;border-radius:99px;background:rgba(255,255,255,0.06);position:relative;cursor:pointer;touch-action:none;user-select:none}
.fader-fill{position:absolute;bottom:0;left:0;right:0;border-radius:99px}
.fader-unity{position:absolute;left:-4px;right:-4px;height:1px;background:rgba(255,255,255,0.18);pointer-events:none}
.fader-thumb{position:absolute;left:50%;transform:translateX(-50%);width:26px;height:26px;border-radius:5px;cursor:grab;border:1px solid}
.fader-thumb:active{cursor:grabbing}
.ch-pct{font-size:10px;font-weight:700;font-family:'DM Mono',monospace}
.sm-row{display:flex;gap:4px}
.btn-sm{width:26px;height:22px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--neutral-500);cursor:pointer;font-size:8px;font-weight:700;font-family:'DM Mono',monospace;transition:all .15s;letter-spacing:.05em}
.btn-dl-stem{width:100%;height:20px;border-radius:5px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.03);color:var(--neutral-600);cursor:pointer;font-size:8px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:2px;transition:all .2s;font-family:'DM Sans',sans-serif}
.btn-dl-stem:hover{border-color:rgba(93,218,157,0.3);color:var(--accent);background:rgba(93,218,157,0.06)}

/* Master channel */
.ch-master{flex-shrink:0;width:120px;border-radius:16px;border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.04);padding:10px 7px 12px;display:flex;flex-direction:column;align-items:center;gap:7px}

/* overview removed */

/* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
footer{border-top:1px solid var(--border);padding-top:28px;text-align:center;margin-top:8px}
footer p{font-size:10px;text-transform:uppercase;letter-spacing:.3em;color:var(--neutral-600);margin-bottom:5px}
.flinks{display:flex;align-items:center;justify-content:center;gap:14px;font-size:10px;margin-bottom:4px}
.flinks a{color:var(--neutral-500);text-decoration:none;transition:color .2s}
.flinks a:hover{color:var(--accent)}
.ver{font-size:10px;color:#2a2a2a;margin-bottom:18px}
.coffee{display:inline-flex;align-items:center;gap:8px;border-radius:99px;border:1px solid var(--border);background:var(--surface);padding:12px 24px;font-size:13px;font-weight:600;color:var(--neutral-400);text-decoration:none;transition:all .2s}
.coffee:hover{border-color:var(--accent);color:var(--accent)}
</style>
</head>
<body>
<div class="app">

  <!-- Header -->
  <div class="header">
    <div class="logo">
      <h1><span class="la">A</span><span class="lb">B</span><span class="lc">C</span><span class="ld">D</span><span class="method">method:<span class="stem">stem</span></span></h1>
      <div class="logo-sub">AI Stem Separator ¬∑ batterista.online</div>
    </div>
    <div class="header-right">
      <span style="color:var(--neutral-600);font-size:11px">Prodotto da</span> <a href="https://batterista.online" target="_blank">batterista.online</a>
    </div>
  </div>

  <!-- Setup -->
  <div class="setup-card" id="setup-card" style="display:none">
    <div class="setup-title">‚öôÔ∏è Configura il tuo Hugging Face Space</div>
    <div class="setup-desc">Inserisci il tuo Space ID (es. <code>tuonome/abcdstem</code>):</div>
    <div class="input-row">
      <input class="space-input" type="text" id="space-input" placeholder="tuonome/abcdstem"/>
      <button class="btn-primary" id="btn-save-space">Salva ‚Üí</button>
    </div>
  </div>

  <!-- Upload -->
  <div class="card" id="upload-card">
    <div class="card-header">
      <span class="card-label">Carica il brano</span>
      <button class="btn-txt" id="btn-change-space" style="height:24px;font-size:9px;padding:0 8px;display:none">‚öôÔ∏è Space</button>
    </div>
    <div class="upload-zone" id="upload-zone">
      <input type="file" id="file-input" accept=".mp3,.wav,.flac,.ogg,.m4a,audio/*"/>
      <div class="upload-icon">üéµ</div>
      <div class="upload-title">Trascina il tuo brano qui</div>
      <div class="upload-sub">oppure clicca per selezionare il file</div>
      <div class="upload-fmt">MP3 ¬∑ WAV ¬∑ FLAC ¬∑ OGG ¬∑ M4A</div>
    </div>
    <div class="upload-warn">
      ‚è± <b>Attenzione ai tempi:</b> la separazione AI richiede mediamente <b>2‚Äì3 minuti</b>, ma per brani lunghi o complessi possono volerci <b>5 minuti o pi√π</b>. Puoi lasciare la tab in background ‚Äî riceverai una <b>notifica browser</b> quando √® pronto.
    </div>
  </div>

  <!-- Status -->
  <div class="card" id="status-card" style="display:none">
    <div class="status-inner">
      <div class="status-top">
        <div class="spinner"></div>
        <div>
          <div class="s-title" id="s-title">Avvio separazione‚Ä¶</div>
          <div class="s-sub" id="s-sub">Connessione allo Space</div>
        </div>
      </div>
      <div class="prog-track"><div class="prog-fill slide" id="prog"></div></div>
      <div class="steps">
        <div class="pill" id="p-connect">üîå Connessione</div>
        <div class="pill" id="p-upload">üì§ Upload</div>
        <div class="pill" id="p-ai">‚öôÔ∏è Separazione</div>
        <div class="pill" id="p-dec">üîä Decodifica</div>
      </div>
      <div id="s-file" style="font-size:11px;color:var(--neutral-600);margin-top:2px"></div>
    </div>
  </div>

  <!-- Error -->
  <div class="err-card" id="err-card">
    <div class="err-title">‚ö†Ô∏è Errore</div>
    <div class="err-msg" id="err-msg"></div>
    <button class="btn-retry" id="btn-retry">‚Ü© Riprova</button>
  </div>

  <!-- Transport -->
  <div class="card" id="mixer-card" style="display:none">
    <div class="card-header">
      <span class="card-label">Transport</span>
      <div style="display:flex;align-items:center;gap:8px">
        <div class="solo-ban" id="solo-ban">SOLO <button id="clear-solo">‚úï</button></div>
        <button class="collapse-btn" id="col-btn">‚ñ≤</button>
      </div>
    </div>
    <!-- Waveform sempre visibile -->
    <div id="waveform-wrap" style="background:rgba(0,0,0,0.45);border-radius:12px;border:1px solid rgba(255,255,255,0.06);overflow:hidden">
      <canvas id="waveform-canvas" width="920" height="76" style="display:block;width:100%;height:76px;cursor:pointer"></canvas>
    </div>
    <!-- Transport bar: sotto la waveform, centrata -->
    <div class="collapsible" id="mixer-body" style="max-height:240px">
      <div id="transport-bar">
        <!-- Riga 1: tempo + titolo -->
        <div id="transport-top">
          <span class="time-display" id="tnow">0:00</span>
          <span class="time-dur" id="tdur">/ 0:00</span>
          <div id="track-name"></div>
        </div>
        <!-- Riga 2: bottoni centrati -->
        <div id="transport-btns">
          <button class="btn-play-main" id="btn-play">‚ñ∂</button>
          <button class="tbn-ic" id="btn-stop" title="Stop">‚ñ†</button>
          <div class="tbn-sep"></div>
          <button class="tbn-txt" id="btn-reset">‚Ü∫ Reset</button>
          <button class="tbn-grn" id="btn-new">Ôºã Nuovo brano</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Channels -->
  <div class="card" id="ch-card" style="display:none">
    <div class="card-header"><span class="card-label">Stem Channels</span></div>
    <div class="ch-scroll-outer">
      <div class="ch-scroll" id="ch-wrap"></div>
      <!-- Scroll hint -->
      <div id="scroll-hint">‚Äπ scorri ‚Ä∫</div>
    </div>
  </div>

  <footer>
    <p>Copyright ¬© Batterista Online ‚Äî Tutti i diritti riservati</p>
    <div class="flinks">
      <a href="https://batterista.online" target="_blank">www.batterista.online</a>
      <span style="color:var(--neutral-600)">‚Ä¢</span>
      <a href="mailto:info@batterista.online">info@batterista.online</a>
    </div>
    <div class="ver">ABCD Method: Stem v1.1</div>
  </footer>
</div>

<script da
